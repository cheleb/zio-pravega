name: QA Reports

on:
  pull_request:
    types: [labeled]
  workflow_dispatch:
jobs:
  reports:
    environment: Codecov
    if: contains( github.event.label.name, 'sonar')
    runs-on: ubuntu-latest   
    steps:
      # - name: Checkout
      #   uses: actions/checkout@v4
      #   with:
      #     fetch-depth: 0
      # - name: Set up JDK 22
      #   uses: actions/setup-java@v4
      #   with:
      #     java-version: "22"
      #     distribution: "zulu"
      #     cache: sbt
      # - name: Run coverage test
      # # Scala 3 is not fully supported for coverage yet
      #   run: sbt "++ 2.13; coverage; test; coverageReport; coverageAggregate"
      # - name: "Upload coverage to Codecov"
      #   uses: "codecov/codecov-action@v4"
      #   with:
      #     token: ${{ secrets.CODECOV_TOKEN }}
      #     fail_ci_if_error: true
      # - name: Fix paths for SonarCloud
      #   run: |
      #       sed -i -e s,`pwd`,/github/workspace,g target/scala-2.13/scoverage-report/scoverage.xml
      # - name: SonarCloud scan 
      #   uses: sonarsource/sonarcloud-github-action@master
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Needed to get PR information, if any
      #     SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      - name: Remove code-quality-checks label
        uses: actions-ecosystem/action-remove-labels@v1
        with:
          labels: |
            needs-code-quality-checks
            sonar
  call-merge-guard:
    needs: reports
    uses: ./.github/workflows/merge-guard.yaml