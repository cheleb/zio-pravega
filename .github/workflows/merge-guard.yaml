name: Merge Guard
permissions:
  pull-requests: write
on:
  workflow_dispatch:
  workflow_call: 
  pull_request:
    types: [synchronize, opened, reopened, labeled, unlabeled]

jobs:
  merge-guard:
    name: Prevent Merging
    runs-on: ubuntu-latest
    steps:
      - name: View context attributes
        uses: actions/github-script@v7
        with:
          script: console.log(context)      
      # - name: Check for label
      #   if: ${{ contains(github.event.*.labels.*.name, 'needs-code-quality-checks') }}
      #   uses: actions/github-script@v7
      #   with:
      #    script: |
      #     core.setFailed('Pull request is labeled as "needs-code-quality-checks"')
      # - name: Ok
      #   uses: actions/github-script@v7
      #   with:
      #     script: |
      #       console.log('Pull request is not labeled as "needs-code-quality-checks"')

  get-labels:
    runs-on: ubuntu-latest
    steps:
      - name: Get labels
        run: |
          labels="$(gh api repos/$OWNER/$REPO_NAME/pulls/$PULL_REQUEST_NUMBER --jq '.labels.[].name')"
          echo "$labels"
        shell: bash
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          OWNER: ${{ github.repository_owner }}
          REPO_NAME: ${{ github.event.repository.name }}
          PULL_REQUEST_NUMBER: ${{ github.event.pull_request.number }}